webpackJsonp([0],[function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.chars=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],e.keys="1234qwerasdfzxcv".split(""),e.width=64,e.height=32},function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function u(t){try{o(r.next(t))}catch(t){i(t)}}function c(t){try{o(r.throw(t))}catch(t){i(t)}}function o(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(u,c)}o((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(u=2&n[0]?i.return:n[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[2&n[0],u.value]),n[0]){case 0:case 1:u=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(u=o.trys,!(u=u.length>0&&u[u.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){o.label=n[1];break}if(6===n[0]&&o.label<u[1]){o.label=u[1],u=n;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(n);break}u[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],i=0}finally{a=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,u,c,o={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},i=this;Object.defineProperty(e,"__esModule",{value:!0});var u,c,o=n(3),s=n(0),f=function(){var t=document.createElement("canvas");t.width=s.width,t.height=s.height;var e=document.getElementById("emulator"),n=t.getContext("2d");if(!e||!n)throw new Error("invalid template");e.appendChild(t),u=n},d=function(){if(o.state.isDrawing){var t=u.getImageData(0,0,s.width,s.height),e=[45,199,239],n=[23,26,40];o.state.screen.forEach(function(r,a){var i=4*a,u=r?e:n;t.data[i]=u[0],t.data[i+1]=u[1],t.data[i+2]=u[2],t.data[i+3]=255}),u.putImageData(t,0,0),o.state.isDrawing=!1}},l=function(){var t=document.getElementById("switch");t&&(c=t)},h=function(){var t=document.getElementById("file");t&&(t.onchange=function(t){if(t.target&&t.target.files&&t.target.files[0]){c.checked=!1;var e=new FileReader;e.onload=function(){return p(e.result)},e.readAsArrayBuffer(t.target.files[0])}})},v=!![/Android/i,/webOS/i,/iPhone/i,/iPad/i].find(function(t){return null!==navigator.userAgent.match(t)}),y=function(){var t=document.getElementById("buttons");t&&v&&s.keys.forEach(function(e){var n=document.createElement("button");t.appendChild(n),n.innerHTML=e;var r=s.keys.indexOf(e);n.onclick=function(){o.state.keys[r]=!0,setTimeout(function(){return o.state.keys[r]=!1},500)}})},p=function(t){o.init(),o.loadProgram(new Uint8Array(t)),setTimeout(function(){return c.checked=!0},500)},m=function(t){return function(e){var n=e.key;"ArrowLeft"===n&&(n="w"),"ArrowRight"===n&&(n="e"),"ArrowDown"===n&&(n="r"),"ArrowUp"===n&&(n="q")," "===n&&(n="q");var r=s.keys.indexOf(n);-1!==r&&(o.state.keys[r]=t)}};(function(){r(i,void 0,void 0,function(){var t,e,n;return a(this,function(r){switch(r.label){case 0:return f(),document.addEventListener("keydown",m(!0)),document.addEventListener("keyup",m(!1)),l(),h(),y(),[4,fetch("./tetris.ch8")];case 1:return t=r.sent(),e=p,[4,t.arrayBuffer()];case 2:return e.apply(void 0,[r.sent()]),n=0,setInterval(function(){!1!==c.checked&&(o.nextCommand(),d(),++n%6==0&&o.state.delayTimer>0&&o.state.delayTimer--)},0),[2]}})})})()},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),i=function(t){return new Array(t).fill(0)};e.getInitialState=function(){return{sp:0,I:0,pc:512,stack:i(16),memory:new Uint8Array(new ArrayBuffer(4096)).fill(0),keys:a.keys.reduce(function(t,e,n){var a;return r({},t,(a={},a[n]=!1,a))},{}),V:i(16),screen:i(a.width*a.height),delayTimer:0,soundTimer:0,isDrawing:!1}},e.loadProgram=function(t){return t.forEach(function(t,n){return e.state.memory[n+512]=t})},e.init=function(t){void 0===t&&(t={}),e.state=r({},e.getInitialState(),t),e.state.memory.set(a.chars)};var u=function(t,n){t+=t<0?a.width:t>a.width?-a.width:0,n+=n<0?a.height:n>a.height?-a.height:0;var r=t+n*a.width;return e.state.screen[r]^=1,!e.state.screen[r]},c=function(t){return(3840&t)>>8},o=function(t){return e.state.V[c(t)]},s=function(t){return(240&t)>>4},f=function(t){return e.state.V[s(t)]},d=function(t){return 15&t},l=function(t){return 255&t},h=function(t){return 4095&t},v=function(t,n){return e.state.V[15]=+n(o(t),f(t))},y=function(t,n){var r=c(t),a=n(e.state.V[r],f(t));e.state.V[r]=a+(a<0?256:a>255?-256:0)},p=function(t,n){return e.state.I=n(o(t),e.state.I)},m=function(t,n){return e.state.pc+=n(o(t),f(t))?2:0};e.nextCommand=function(){return e.run(e.state.memory[e.state.pc]<<8|e.state.memory[e.state.pc+1])},e.run=function(t){switch(e.state.pc+=2,61440&t){case 0:switch(t){case 224:return void e.state.screen.fill(0);case 238:return e.state.sp--,void(e.state.pc=e.state.stack[e.state.sp])}break;case 4096:e.state.pc=h(t);break;case 8192:e.state.stack[e.state.sp]=e.state.pc,e.state.sp++,e.state.pc=h(t);break;case 12288:m(t,function(e){return e===l(t)});break;case 16384:m(t,function(e){return e!==l(t)});break;case 20480:m(t,function(t,e){return t===e});break;case 24576:y(t,function(){return l(t)});break;case 28672:y(t,function(e){return e+l(t)});break;case 32768:switch(15&t){case 0:return void y(t,function(t,e){return e});case 1:return void y(t,function(t,e){return t|e});case 2:return void y(t,function(t,e){return t&e});case 3:return void y(t,function(t,e){return t^e});case 4:return v(t,function(t,e){return t+e>255}),void y(t,function(t,e){return t+e});case 5:return v(t,function(t,e){return t>e}),void y(t,function(t,e){return t-e});case 6:return v(t,function(t){return 1&t}),void y(t,function(t){return t>>1});case 7:return v(t,function(t,e){return e>t}),void y(t,function(t,e){return e-t});case 14:return v(t,function(t){return 240&t}),void y(t,function(t){return t<<1})}break;case 36864:m(t,function(t,e){return t!==e});break;case 40960:p(t,function(){return h(t)});break;case 45056:e.state.pc=h(t)+e.state.V[0];break;case 49152:y(t,function(){return~~(255*Math.random())&l(t)});break;case 53248:var n=e.state.I,r=e.state.V,a=e.state.memory,i=o(t),s=f(t),w=d(t);r[15]=0;for(var k=0;k<w;k++)for(var g=a[n+k],b=0;b<8;b++)(128&g)>0&&u(i+b,s+k)&&(r[15]=1),g<<=1;return void(e.state.isDrawing=!0);case 57344:switch(255&t){case 158:return void m(t,function(t){return e.state.keys[t]});case 161:return void m(t,function(t){return!e.state.keys[t]})}break;case 61440:switch(255&t){case 7:return void y(t,function(){return e.state.delayTimer});case 10:for(var I=!1,E=0;E<16;++E)e.state.keys[E]&&(e.state.V[c(t)]=E,I=!0);return void(I||(e.state.pc-=2));case 21:return void(e.state.delayTimer=o(t));case 24:return void(e.state.soundTimer=o(t));case 30:return e.state.V[15]=+(e.state.I+o(t)>4095),void p(t,function(t,e){return t+e});case 41:return void p(t,function(t){return 5*t});case 51:var a=e.state.memory,n=e.state.I,i=o(t);return a[n+2]=i%10,a[n+1]=~~(i/10)%10,void(a[n]=~~(i/100)%10);case 85:case 101:for(var b=c(t),a=e.state.memory,r=e.state.V,n=e.state.I,x=101==(255&t),E=0;E<=b;E++)x?r[E]=a[n+E]:a[n+E]=r[E];return void(e.state.I+=b+1)}break;default:console.log("invalid opcode: "+t+"!")}}}],[1]);
//# sourceMappingURL=client.436f3770.js.map